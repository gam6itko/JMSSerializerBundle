{%- extends '@WebProfiler/Profiler/layout.html.twig' -%}

{%- block toolbar -%}

    {%- set icon -%}
        {{ include('@JMSSerializer/icon.svg') }}
        <span class="sf-toolbar-value">{{ collector.runs|length }}</span>
        <span class="sf-toolbar-label">in</span>
        <span class="sf-toolbar-value">{{ collector.runsDuration|number_format(2) }}</span>
        <span class="sf-toolbar-label">ms</span>
    {%- endset -%}

    {%- set text -%}
        <div class="sf-toolbar-info-piece">
            <b>Runs</b>
            <span class="sf-toolbar-status">{{ collector.runs|length }}</span>
        </div>
        <div class="sf-toolbar-info-piece">
            <b>Events</b>
            <span class="sf-toolbar-status">{{ collector.triggeredListeners|length }}</span>
        </div>
        <div class="sf-toolbar-info-piece">
            <b>Handlers</b>
            <span class="sf-toolbar-status">{{ collector.triggeredHandlers|length }}</span>
        </div>
        <div class="sf-toolbar-info-piece">
            <b>Metadata</b>
            <span class="sf-toolbar-status {{ collector.loadedMetadata|length > 0 ? 'sf-toolbar-status-yellow' : '' }}">{{ collector.loadedMetadata|length }}</span>
        </div>
    {%- endset -%}

    {%- include '@WebProfiler/Profiler/toolbar_item.html.twig' with { 'link': profiler_url } -%}
{%- endblock -%}

{%- block head -%}
    <style>
        {{ include('@JMSSerializer/Collector/style/httplug.css.twig') }}
    </style>
    <style>
        .margin-left {
            margin-left: 10px;
        }

        .margin-top {
            margin-top: 10px;
        }

        .margin-bottom {
            margin-bottom: 10px;
        }
    </style>
    <script type="text/javascript">
        {{ include('@JMSSerializer/Collector/script/httplug.js.twig') }}
    </script>
    {{ parent() }}
{%- endblock -%}

{%- block menu -%}
    {# This left-hand menu appears when using the full-screen profiler. #}
    <span class="label {{ collector.runs is empty ? 'disabled' : '' }}">
        <span class="icon">
            {{ include('@JMSSerializer/icon.svg') }}
        </span>
        <strong>JMS Serializer</strong>
        {%- if collector.runs is not empty -%}
            <span class="count">
                <span>{{ collector.runs|length }}</span>
            </span>
        {%- endif -%}
    </span>
{%- endblock -%}

{%- block panel -%}
    <h2>JMS Serializer</h2>

    <div class="metrics">
        <div class="metric">
            <span class="value">{{ collector.runsDuration|number_format(2) }} <span class="unit">ms</span></span>
            <span class="label">Total execution time</span>
        </div>

        <div class="metric">
            <span class="value">{{ collector.runs|length }}</span>
            <span class="label">Serializer runs</span>
        </div>
    </div>

    <div class="sf-tabs">
        <div class="tab">
            <h3 class="tab-title jms-toggle" data-toggle="#jms-runs">Runs <span
                        class="badge">{{ collector.runs|length }}</span></h3>

            <div class="tab-content">
                <p class="help">Serializer calls</p>

                <div id="jms-runs">
                    {%- include '@JMSSerializer/Collector/runs.html.twig' -%}
                </div>

            </div>
        </div>

        <div class="tab">
            <h3 class="tab-title jms-toggle" data-toggle="#jms-events">Events <span
                        class="badge">{{ collector.triggeredListeners|length }}</span></h3>

            <div class="tab-content">
                <p class="help">
                    These messages are sent by client named
                </p>

                <div id="jms-events">
                    {%- include '@JMSSerializer/Collector/events.html.twig' -%}
                </div>

            </div>
        </div>

        <div class="tab">
            <h3 class="tab-title jms-toggle" data-toggle="#jms-handlers">Handlers <span
                        class="badge">{{ collector.triggeredHandlers|length }}</span></h3>

            <div class="tab-content">
                <p class="help">
                    These messages are sent by client named
                </p>

                <div id="jms-handlers">
                    {%- include '@JMSSerializer/Collector/handlers.html.twig' -%}
                </div>
            </div>
        </div>

        <div class="tab">
            <h3 class="tab-title">Metadata <span class="badge">{{ collector.loadedMetadata|length }}</span></h3>

            <div class="tab-content">
                <p class="help">
                    These messages are sent by client named
                </p>

                <div id="jms-metadata">
                    {%- include '@JMSSerializer/Collector/metadata.html.twig' -%}
                </div>
            </div>
        </div>
    </div>
{%- endblock -%}
