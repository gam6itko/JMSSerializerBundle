{% import _self as helper %}

<h1>Type Handlers</h1>

<div class="sf-tabs">
    <div class="tab">
        <h3 class="tab-title">Triggered Handlers <span class="badge">{{ collector.triggeredHandlers|length }}</span></h3>

        <div class="tab-content">
            {{ helper.render_table(collector.triggeredHandlers, true) }}
        </div>
    </div>

    <div class="tab">
        <div class="tab-title">Not Triggered Handlers <span class="badge">{{ collector.notTriggeredHandlers|length }}</span></div>
        <div class="tab-content">
            {{ helper.render_table(collector.notTriggeredHandlers, false) }}
        </div>
    </div>
</div>

{% macro render_table(listeners, called) %}
    {% for direction, calls in listeners %}
        <h3>
            {%- if direction == constant('JMS\\Serializer\\GraphNavigatorInterface::DIRECTION_SERIALIZATION') -%}
                Serialization
            {%- else -%}
                Deserialization
            {%- endif -%}
        </h3>
        <table>
            <thead>
            <tr>
                <th>Handler</th>
                <th>Class</th>
                <th>Method</th>
                <th>Format</th>
                {%- if called|default(false) -%}
                    <th>Calls</th>
                    <th>Total duration (sec)</th>
                {%- endif -%}
            </tr>
            </thead>
            {%- for call in calls -%}
                <tr>
                    <td>{{ call.handler }}</td>
                    <td>{{ call.class }}</td>
                    <td>{{ call.method }}</td>
                    <td>{{ call.format }}</td>
                    {%- if called|default(false) -%}
                        <td>{{ call.calls|length }}</td>
                        <td>{{ call.totalDuration|default }}</td>
                    {%- endif -%}
                </tr>
            {%- endfor -%}
        </table>
    {% endfor %}
{% endmacro %}
